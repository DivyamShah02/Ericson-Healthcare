<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Ericson Healthcare</title>

    <!-- Import BootStrap CSS Library -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <!-- Import Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Lexend:wght@100..900&family=Plus+Jakarta+Sans:ital,wght@0,200..800;1,200..800&display=swap">

    <!-- Import FontAwsome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- Import Wow Animation CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">

    <!-- Import the official PDF.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/loader.css">

</head>

<body>
    <div id="spinner" class="spinner-container p-2">
        <div class="spinner"></div>
        <!-- <div id="spinner-text" class="loading-text text-center">loading!</div> -->
    </div>

    <div id="main-content" class="blur">
        <div class="px-3 px-md-5 py-3 bg-white eh-bg-blue-primary fixed-top text-white">
            <div class="d-flex justify-content-between align-items-center">
                <i class="fa fa-chevron-left fa-xl" onclick="window.location.href=`{% url 'dashboard-list' %}`;"></i>
                <div class="mx-auto p-0" style="font-size: 18px;"><b id="case_id_text">Case #</b></div>
                <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas"
                    data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar" aria-label="Toggle navigation">
                    <i class="fa fa-bars fa-xl"></i>
                </button>
            </div>
        </div>

        <div class="offcanvas offcanvas-end none-div" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
            <div class="offcanvas-header">
                <h5 class="offcanvas-title" id="offcanvasNavbarLabel"><b>Ericson Healthcare</b></h5>
                <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div class="offcanvas-body">
                <div>
                    <div class="eh-menu-item-active p-3 py-2 mb-2 text-start" onclick="window.location.href=`{% url 'dashboard-list' %}`">
                        <i class="fa fa-home fa-md me-2"></i>Dashboard
                    </div>

                    <!-- <div class="eh-menu-item p-3 py-2 mb-2 text-start" onclick="window.location.href=`{% url 'reports-list' %}`">
                        <i class="fa fa-chart-line fa-md me-2"></i>Reports
                    </div> -->

                    <!-- <div class="eh-menu-item p-3 py-2 mb-2 text-start">
                        <i class="fa-regular fa-circle-user fa-md me-2"></i>Account
                    </div> -->
                    <hr>

                    <div class="eh-menu-item p-3 py-2 mb-2 text-start" onclick="window.location.href=`{% url 'logout-api-list' %}`">
                        <i class="fa fa-arrow-right-from-bracket fa-md me-2"></i>Log Out
                    </div>

                </div>
            </div>
        </div>

        <!-- Process Step Section -->
        <div class="container py-4 pt-4 mt-5">
            <h1 id="step-name" class="eh-text-blue-primary"></h1>
            <div class="">
                <div class="row p-3 pb-0" id="step-1" style="display: none;">
                    <div class="col p-0 m-0 text-center">
                        <div class="eh-progress-bar mb-3">
                            &nbsp;&nbsp;&nbsp;
                            <!-- <i class="fa fa-circle-check fa-xl eh-progress-bar-icon"></i> -->
                            <i class="fa fa-circle-dot fa-sm eh-progress-bar-icon"></i>
                            <div class="eh-progress-bar-line-completed"></div>
                        </div>
                    </div>

                    <div class="col p-0 m-0 text-center">
                        <div class="eh-progress-bar mb-3">
                            <i class="fa fa-2 fa-sm eh-progress-bar-icon-incomplete"></i>
                            <div class="eh-progress-bar-line"></div>
                        </div>
                    </div>

                    <div class="col p-0 m-0 text-center">
                        <div class="eh-progress-bar mb-3">
                            <i class="fa fa-3 fa-sm eh-progress-bar-icon-incomplete"></i>
                            <div class="eh-progress-bar-line"></div>
                        </div>
                    </div>

                    <div class="col p-0 m-0 text-center">
                        <div class="eh-progress-bar mb-3">
                            <i class="fa fa-4 fa-sm eh-progress-bar-icon-incomplete"></i>
                            <div class="eh-progress-bar-line"></div>
                        </div>
                    </div>

                    <div class="col p-0 m-0 text-center">
                        <div class="eh-progress-bar mb-3">
                            <i class="fa fa-5 fa-sm eh-progress-bar-icon-incomplete"></i>
                            <!-- <div class="eh-progress-bar-line"></div> -->
                        </div>
                    </div>
                </div>

                <div class="row p-3 pb-0" id="step-2" style="display: none;">
                    <div class="col p-0 m-0 text-center">
                        <div class="eh-progress-bar mb-3">
                            &nbsp;&nbsp;&nbsp;
                            <i class="fa fa-circle-check fa-xl eh-progress-bar-icon"></i>
                            <div class="eh-progress-bar-line-completed"></div>
                        </div>
                    </div>

                    <div class="col p-0 m-0 text-center">
                        <div class="eh-progress-bar mb-3">
                            <i class="fa fa-circle-dot fa-sm eh-progress-bar-icon"></i>
                            <div class="eh-progress-bar-line"></div>
                        </div>
                    </div>

                    <div class="col p-0 m-0 text-center">
                        <div class="eh-progress-bar mb-3">
                            <i class="fa fa-3 fa-sm eh-progress-bar-icon-incomplete"></i>
                            <div class="eh-progress-bar-line"></div>
                        </div>
                    </div>

                    <div class="col p-0 m-0 text-center">
                        <div class="eh-progress-bar mb-3">
                            <i class="fa fa-4 fa-sm eh-progress-bar-icon-incomplete"></i>
                            <div class="eh-progress-bar-line"></div>
                        </div>
                    </div>

                    <div class="col p-0 m-0 text-center">
                        <div class="eh-progress-bar mb-3">
                            <i class="fa fa-5 fa-sm eh-progress-bar-icon-incomplete"></i>
                            <!-- <div class="eh-progress-bar-line"></div> -->
                        </div>
                    </div>
                </div>

                <div class="row p-3 pb-0" id="step-3" style="display: none;">
                    <div class="col p-0 m-0 text-center">
                        <div class="eh-progress-bar mb-3">
                            &nbsp;&nbsp;&nbsp;
                            <i class="fa fa-circle-check fa-xl eh-progress-bar-icon"></i>
                            <div class="eh-progress-bar-line-completed"></div>
                        </div>
                    </div>

                    <div class="col p-0 m-0 text-center">
                        <div class="eh-progress-bar mb-3">
                            <i class="fa fa-circle-check fa-xl eh-progress-bar-icon"></i>
                            <div class="eh-progress-bar-line-completed"></div>
                        </div>
                    </div>

                    <div class="col p-0 m-0 text-center">
                        <div class="eh-progress-bar mb-3">
                            <i class="fa fa-circle-dot fa-sm eh-progress-bar-icon"></i>
                            <div class="eh-progress-bar-line"></div>
                        </div>
                    </div>

                    <div class="col p-0 m-0 text-center">
                        <div class="eh-progress-bar mb-3">
                            <i class="fa fa-4 fa-sm eh-progress-bar-icon-incomplete"></i>
                            <div class="eh-progress-bar-line"></div>
                        </div>
                    </div>

                    <div class="col p-0 m-0 text-center">
                        <div class="eh-progress-bar mb-3">
                            <i class="fa fa-5 fa-sm eh-progress-bar-icon-incomplete"></i>
                            <!-- <div class="eh-progress-bar-line"></div> -->
                        </div>
                    </div>
                </div>

                <div class="row p-3 pb-0" id="step-4" style="display: none;">
                    <div class="col p-0 m-0 text-center">
                        <div class="eh-progress-bar mb-3">
                            &nbsp;&nbsp;&nbsp;
                            <i class="fa fa-circle-check fa-xl eh-progress-bar-icon"></i>
                            <div class="eh-progress-bar-line-completed"></div>
                        </div>
                    </div>

                    <div class="col p-0 m-0 text-center">
                        <div class="eh-progress-bar mb-3">
                            <i class="fa fa-circle-check fa-xl eh-progress-bar-icon"></i>
                            <div class="eh-progress-bar-line-completed"></div>
                        </div>
                    </div>

                    <div class="col p-0 m-0 text-center">
                        <div class="eh-progress-bar mb-3">
                            <i class="fa fa-circle-check fa-xl eh-progress-bar-icon"></i>
                            <div class="eh-progress-bar-line-completed"></div>
                        </div>
                    </div>

                    <div class="col p-0 m-0 text-center">
                        <div class="eh-progress-bar mb-3">
                            <i class="fa fa-circle-dot fa-sm eh-progress-bar-icon"></i>
                            <div class="eh-progress-bar-line"></div>
                        </div>
                    </div>

                    <div class="col p-0 m-0 text-center">
                        <div class="eh-progress-bar mb-3">
                            <i class="fa fa-5 fa-sm eh-progress-bar-icon-incomplete"></i>
                            <!-- <div class="eh-progress-bar-line"></div> -->
                        </div>
                    </div>
                </div>

                <div class="row p-3 pb-0" id="step-5" style="display: none;">
                    <div class="col p-0 m-0 text-center">
                        <div class="eh-progress-bar mb-3">
                            &nbsp;&nbsp;&nbsp;
                            <i class="fa fa-circle-check fa-xl eh-progress-bar-icon"></i>
                            <div class="eh-progress-bar-line-completed"></div>
                        </div>
                    </div>

                    <div class="col p-0 m-0 text-center">
                        <div class="eh-progress-bar mb-3">
                            <i class="fa fa-circle-check fa-xl eh-progress-bar-icon"></i>
                            <div class="eh-progress-bar-line-completed"></div>
                        </div>
                    </div>

                    <div class="col p-0 m-0 text-center">
                        <div class="eh-progress-bar mb-3">
                            <i class="fa fa-circle-check fa-xl eh-progress-bar-icon"></i>
                            <div class="eh-progress-bar-line-completed"></div>
                        </div>
                    </div>

                    <div class="col p-0 m-0 text-center">
                        <div class="eh-progress-bar mb-3">
                            <i class="fa fa-circle-check fa-xl eh-progress-bar-icon"></i>
                            <div class="eh-progress-bar-line-completed"></div>
                        </div>
                    </div>

                    <div class="col p-0 m-0 text-center">
                        <div class="eh-progress-bar mb-3">
                            <i class="fa fa-circle-dot fa-sm eh-progress-bar-icon"></i>
                            <!-- <div class="eh-progress-bar-line"></div> -->
                        </div>
                    </div>
                </div>

                <div class="row p-3 pb-0" id="step-6" style="display: none;">
                    <div class="col p-0 m-0 text-center">
                        <div class="eh-progress-bar mb-3">
                            &nbsp;&nbsp;&nbsp;
                            <i class="fa fa-circle-check fa-xl eh-progress-bar-icon"></i>
                            <div class="eh-progress-bar-line-completed"></div>
                        </div>
                    </div>

                    <div class="col p-0 m-0 text-center">
                        <div class="eh-progress-bar mb-3">
                            <i class="fa fa-circle-check fa-xl eh-progress-bar-icon"></i>
                            <div class="eh-progress-bar-line-completed"></div>
                        </div>
                    </div>

                    <div class="col p-0 m-0 text-center">
                        <div class="eh-progress-bar mb-3">
                            <i class="fa fa-circle-check fa-xl eh-progress-bar-icon"></i>
                            <div class="eh-progress-bar-line-completed"></div>
                        </div>
                    </div>

                    <div class="col p-0 m-0 text-center">
                        <div class="eh-progress-bar mb-3">
                            <i class="fa fa-circle-check fa-xl eh-progress-bar-icon"></i>
                            <div class="eh-progress-bar-line-completed"></div>
                        </div>
                    </div>

                    <div class="col p-0 m-0 text-center">
                        <div class="eh-progress-bar mb-3">
                            <i class="fa fa-circle-check fa-xl eh-progress-bar-icon"></i>
                            <!-- <div class="eh-progress-bar-line"></div> -->
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <section>
            <div class="container">
                <ul class="nav nav-underline mb-3 row" id="case-tab" role="tablist">
                    <li class="nav-item col text-center" role="presentation">
                        <a class="nav-link eh-nav-link-case-coordinator active" id="overview-tab" data-bs-toggle="pill"
                            data-bs-target="#overview" role="tab" aria-controls="overview"
                            aria-selected="true">Overview</a>
                    </li>
                    <li class="nav-item col text-center" role="presentation">
                        <a class="nav-link eh-nav-link-case-coordinator" id="visits-tab" data-bs-toggle="pill"
                            data-bs-target="#visits" role="tab" aria-controls="visits" aria-selected="false">Visits</a>
                    </li>
                    <li class="nav-item col text-center" role="presentation">
                        <a class="nav-link eh-nav-link-case-coordinator" id="documents-tab" data-bs-toggle="pill"
                            data-bs-target="#documents" role="tab" aria-controls="documents"
                            aria-selected="false">Documents</a>
                    </li>
                    <!-- <li class="nav-item col text-center" role="presentation">
                      <a class="nav-link eh-nav-link-case-coordinator" id="reports-tab" data-bs-toggle="pill" data-bs-target="#reports" role="tab" aria-controls="reports" aria-selected="false">Reports</a>
                    </li> -->
                </ul>
                <div class="tab-content" id="case-tabContent">
                    <div class="tab-pane fade show active" id="overview" role="tabpanel" aria-labelledby="overview-tab"
                        tabindex="0">
                        <h3 class="eh-head my-3">Case Overview</h3>
                        <form action="" id="case_details_form">
                            <div class="mb-3">
                                <label for="claim_number" class="form-label eh-label">Claim Number</label>
                                <input type="text" class="form-control dark-input" id="claim_number" name="claim_number"
                                    placeholder="Enter Claim Number" autofocus>
                            </div>
                            <div class="mb-3">
                                <label for="insurance_company" class="form-label eh-label">Insurance Company</label>
                                <input type="text" class="form-control dark-input" id="insurance_company" name="insurance_company"
                                    placeholder="Enter Insurance Company">
                            </div>
                            <div class="mb-3">
                                <label for="type_of_case" class="form-label eh-label">Type Of Case</label>
                                <!-- <input type="text" class="form-control dark-input" id="type_of_case" name="type_of_case"
                                    placeholder="Enter Type Of Case"> -->
                                <select class="form-select dark-input" aria-label="select" id="type_of_case" name="type_of_case">
                                    <option value="">Select type of case</option>
                                    <option value="CashlessClaimReport">Cashless Claim</option>
                                    <option value="ClaimReport">Claim</option>
                                    <option value="HDCClosureReport">HDC Closure</option>
                                    <option value="HealthClaimReport">Health Claim</option>
                                    <option value="ICLMClosureReport">ICLM Closure</option>
                                    <option value="PADeathReport">PA Death</option>
                                    <option value="SecureMindCriticalIllnessReport">Secure Mind Critical Illness</option>
                                    <option value="TTDReport">TTD</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="doa" class="form-label eh-label">DOA</label>
                                <input type="date" class="form-control dark-input" id="doa" name="doa"
                                    placeholder="Enter DOA">
                            </div>
                            <div class="mb-3">
                                <label for="dod" class="form-label eh-label">DOD</label>
                                <input type="date" class="form-control dark-input" id="dod" name="dod"
                                    placeholder="Enter DOD">
                            </div>
                            <div class="mb-3">
                                <label for="hospital_name" class="form-label eh-label">Hospital Name</label>
                                <input type="text" class="form-control dark-input" id="hospital_name"
                                    name="hospital_name" placeholder="Enter Hospital Name">
                            </div>
                            <div class="mb-3">
                                <label for="city" class="form-label eh-label">City</label>
                                <input type="text" class="form-control dark-input" id="city" name="city"
                                    placeholder="Enter City">
                            </div>
                            <div class="mb-3">
                                <label for="state" class="form-label eh-label">State</label>
                                <input type="text" class="form-control dark-input" id="state" name="state"
                                    placeholder="Enter State">
                            </div>
                            <div class="mb-3">
                                <label for="claim_value" class="form-label eh-label">Claim Value</label>
                                <input type="text" class="form-control dark-input" id="claim_value" name="claim_value"
                                    placeholder="Enter Claim Value">
                            </div>
                            <div class="mb-3">
                                <label for="diagnosis" class="form-label eh-label">Diagnosis</label>
                                <input type="text" class="form-control dark-input" id="diagnosis" name="diagnosis"
                                    placeholder="Enter Diagnosis">
                            </div>
                            <div class="mb-3 mt-4">
                                <button type="submit"
                                    class="btn btn-primary eh-btn-blue-primary-no-hover w-100 d-flex justify-content-between align-items-center">
                                    <b class="mx-auto">Save Case Details</b>
                                    <i class="fa fa-arrow-right fa-xl"></i>
                                </button>
                            </div>
                        </form>
                    </div>
                    <div class="tab-pane fade" id="visits" role="tabpanel" aria-labelledby="visits-tab" tabindex="0">
                        <h3 class="eh-head">Visits Details</h3>

                        <button class="btn eh-btn-blue-primary-outline w-100 py-2" type="button" id="addVisitBtn" onclick="defaultVisitModal()"><b>Add Visit</b></button>

                        <button style="display: none;" id="addVisitBtnModal" data-bs-toggle="modal"
                        data-bs-target="#addVisitModal"></button>

                        <!-- Modal -->
                        <div class="modal fade" id="addVisitModal" tabindex="-1" aria-labelledby="addVisitModalLabel"
                            aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h1 class="modal-title fs-5" id="addVisitModalLabel">Add Visit</h1>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <form action="" id="add_visit_form">
                                            <input type="hidden" name="edit_visit_id" id="edit_visit_id">
                                            <div class="mb-3">
                                                <label for="type_of_visit" class="form-label eh-label">Type of
                                                    visit</label>
                                                <select class="form-select dark-input" aria-label="select"
                                                    onchange="handleOptionChange()" id="type_of_visit" name="type_of_visit">
                                                    <option value="default">Select type of visit</option>
                                                    <option value="Hospital">Hospital</option>
                                                    <!-- <option value="Treating_doctor">Treating Doctor</option> -->
                                                    <option value="Lab">Lab</option>
                                                    <option value="Chemist">Chemist</option>
                                                </select>
                                            </div>
                                            <div id="add_visit_form_inputs"></div>
                                            <div class="mb-3">
                                                <label for="investigator_select"
                                                    class="form-label eh-label">Investigator Officer</label>
                                                <select class="form-select dark-input" aria-label="select"
                                                    id="investigator_select" name="investigator_id">
                                                    <option value="">Select Investigator Officer</option>
                                                    
                                                </select>
                                            </div>
                                            <div class="mb-3">
                                                <label for="" class="form-label eh-label">Questions</label>
                                                <div class="select-question-card p-2">
                                                    <div class="d-flex" style="cursor: pointer;"
                                                        onclick="toggleAddQuestions()">
                                                        <div class="col text-start">
                                                            <label for="" class="form-label eh-label m-0">Select
                                                                Questions</label>
                                                        </div>
                                                        <div class="col text-end">
                                                            <i class="fa fa-chevron-down" id="add-question-icon"></i>
                                                        </div>
                                                    </div>
                                                    <div id="questions-list" class="mt-2" style="display: none;">
                                                        <!-- <div class="form-check">
                                                            <input class="form-check-input" type="checkbox"
                                                                id="question1" name="question1"
                                                                value="option1">
                                                            <label class="form-check-label"
                                                                for="question1">Checkbox 1</label>
                                                        </div>
                                                         -->
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary"
                                            data-bs-dismiss="modal">Close</button>
                                        <button type="button" class="btn eh-btn-blue-primary" onclick="createNewVisit()">Save changes</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="visit-cards">
                            <div class="my-3">
                                <div class="p-5 text-center dark-input" id="no-visit-created"
                                  style="border-radius: 10px; background-color: var(--eh-danger);">
                                  <i class="fa fa-triangle-exclamation fa-xl eh-text-blue-primary" style="font-size: 2.5rem;"></i>
                                  <p class="p-0 m-0 mt-2 eh-text-blue-primary"><b>0 Visit created for this case</b></p>
                                </div>
                            </div>
                            <!-- <div class="p-3 mt-3 visit-card">
                                <div class="d-flex" id="card-1" onclick="toggleCard(this)" style="cursor: pointer;">
                                    <div class="col text-start">
                                        <h5 class="m-0">Hospital Visit</h5>
                                    </div>
                                    <div class="col text-end"><i class="fa fa-plus" id="card-1-icon"></i></div>
                                </div>
                                <div style="display: none;" id="card-1-detail">
                                    <hr>
                                    <div class="row">
                                        <div class="col-12 text-end mb-3">
                                            <i
                                                class="fa fa-pen fa-lg eh-text-blue-primary"></i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                            <i class="fa fa-trash fa-lg text-danger"></i>
                                        </div>
                                        <div class="col-6 text-start eh-key">Hospital Name</div>
                                        <div class="col-6 text-end text-lg-start eh-value">City Hospital</div>
                                        <div class="col-12 px-3">
                                            <hr class="p-0 my-1 visit-card-eh-hr">
                                        </div>

                                        <div class="col-6 text-start eh-key">State</div>
                                        <div class="col-6 text-end text-lg-start eh-value">Maharashtra</div>
                                        <div class="col-12 px-3">
                                            <hr class="p-0 my-1 visit-card-eh-hr">
                                        </div>

                                        <div class="col-6 text-start eh-key">City</div>
                                        <div class="col-6 text-end text-lg-start eh-value">Mumbai</div>
                                        <div class="col-12 px-3">
                                            <hr class="p-0 my-1 visit-card-eh-hr">
                                        </div>

                                        <div class="col-6 text-start eh-key">Registration Number</div>
                                        <div class="col-6 text-end text-lg-start eh-value">2431244323</div>
                                        <div class="col-12 px-3">
                                            <hr class="p-0 my-1 visit-card-eh-hr">
                                        </div>

                                        <div class="col-6 text-start eh-key">No of Beds</div>
                                        <div class="col-6 text-end text-lg-start eh-value">45</div>
                                        <div class="col-12 px-3">
                                            <hr class="p-0 my-1 visit-card-eh-hr">
                                        </div>

                                        <div class="col-6 text-start eh-key">ICU</div>
                                        <div class="col-6 text-end text-lg-start eh-value">Yes</div>
                                        <div class="col-12 px-3">
                                            <hr class="p-0 my-1 visit-card-eh-hr">
                                        </div>

                                        <div class="col-6 text-start eh-key">OT</div>
                                        <div class="col-6 text-end text-lg-start eh-value">Yes</div>
                                        <div class="col-12 px-3">
                                            <hr class="p-0 my-1 visit-card-eh-hr">
                                        </div>

                                        <div class="col-6 text-start eh-key">Nursing staff</div>
                                        <div class="col-6 text-end text-lg-start eh-value">15</div>
                                        <div class="col-12 px-3">
                                            <hr class="p-0 my-1 visit-card-eh-hr">
                                        </div>

                                        <div class="col-6 text-start eh-key">RMO</div>
                                        <div class="col-6 text-end text-lg-start eh-value">15</div>
                                        <div class="col-12 px-3">
                                            <hr class="p-0 my-1 visit-card-eh-hr">
                                        </div>

                                        <div class="col-6 text-start eh-key">TD registration number</div>
                                        <div class="col-6 text-end text-lg-start eh-value">3454657652</div>
                                        <div class="col-12 px-3">
                                            <hr class="p-0 my-1 visit-card-eh-hr">
                                        </div>

                                        <div class="col-6 text-start eh-key">Degree</div>
                                        <div class="col-6 text-end text-lg-start eh-value">M.B.B.S</div>
                                        <div class="col-12 px-3">
                                            <hr class="p-0 my-1 visit-card-eh-hr">
                                        </div>

                                        <div class="col-6 text-start eh-key">Owner of the hospital</div>
                                        <div class="col-6 text-end text-lg-start eh-value">BMC</div>
                                        <div class="col-12 px-3">
                                            <hr class="p-0 my-1 visit-card-eh-hr">
                                        </div>

                                        <div class="col-6 text-start eh-key">Doctor Registration Number</div>
                                        <div class="col-6 text-end text-lg-start eh-value">465721965322</div>
                                        <div class="col-12 px-3">
                                            <hr class="p-0 my-1 visit-card-eh-hr">
                                        </div>

                                        <div class="col-6 text-start eh-key">Doctor Contact Number</div>
                                        <div class="col-6 text-end text-lg-start eh-value">9898000001</div>
                                        <div class="col-12 px-3">
                                            <hr class="p-0 my-1 visit-card-eh-hr">
                                        </div>

                                        <div class="col-6 text-start eh-key">Doctor Email Id</div>
                                        <div class="col-6 text-end text-lg-start eh-value">doctor@email.com</div>
                                        <div class="col-12 px-3">
                                            <hr class="p-0 my-1 visit-card-eh-hr">
                                        </div>

                                        <div class="col-6 text-start eh-key">Investigating Officer</div>
                                        <div class="col-6 text-end text-lg-start eh-value">Divyam Shah</div>
                                        <div class="col-12 px-3">
                                            <hr class="p-0 my-1 visit-card-eh-hr">
                                        </div>

                                        <div class="col-12 mt-2">
                                            <div class="mb-3">
                                                <div class="select-question-card p-2">
                                                    <div class="d-flex" id="visit1-questions" style="cursor: pointer;"
                                                        onclick="viewQuestions(this)">
                                                        <div class="col text-start">
                                                            <label for=""
                                                                class="form-label eh-label m-0">Questions</label>
                                                        </div>
                                                        <div class="col text-end">
                                                            <i class="fa fa-chevron-down"
                                                                id="visit1-questions-icon"></i>
                                                        </div>
                                                    </div>
                                                    <div id="visit1-questions-list" class="mt-4" style="display: none;">
                                                        <div class="p-2 py-0">
                                                            <label class="form-label eh-label m-0"><b>Q1)</b> What are
                                                                the complaints presented by you during the admission at
                                                                SUNFLOWER WOMENS HOSPITAL?</label>
                                                            <hr class="m-1">

                                                        </div>
                                                        <div class="p-2 py-0">
                                                            <label class="form-label eh-label m-0"><b>Q2)</b> Since when
                                                                you were suffering from the same?</label>
                                                            <hr class="m-1">

                                                        </div>
                                                        <div class="p-2 py-0">
                                                            <label class="form-label eh-label m-0"><b>Q3)</b> Where were
                                                                you consulting for the same problem before this
                                                                admission? Kindly provide a copy of the previous
                                                                consultation paper?</label>
                                                            <hr class="m-1">

                                                        </div>
                                                        <div class="p-2 py-0">
                                                            <label class="form-label eh-label m-0"><b>Q4)</b> Please
                                                                mention the reason for selecting hospital </label>
                                                            <hr class="m-1">

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>

                            </div>

                            <div class="p-3 mt-3 visit-card">
                                <div class="d-flex" id="card-2" onclick="toggleCard(this)" style="cursor: pointer;">
                                    <div class="col text-start">
                                        <h5 class="m-0">Chemist Visit</h5>
                                    </div>
                                    <div class="col text-end"><i class="fa fa-plus" id="card-2-icon"></i></div>
                                </div>
                                <div style="display: none;" id="card-2-detail">
                                    <hr>
                                    <div class="row">
                                        <div class="col-12 text-end mb-3">
                                            <i
                                                class="fa fa-pen fa-lg eh-text-blue-primary"></i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                            <i class="fa fa-trash fa-lg text-danger"></i>
                                        </div>
                                        <div class="col-6 text-start eh-key">Name of Chemist</div>
                                        <div class="col-6 text-end text-lg-start eh-value">M.K. Medicals</div>
                                        <div class="col-12 px-3">
                                            <hr class="p-0 my-1 visit-card-eh-hr">
                                        </div>

                                        <div class="col-6 text-start eh-key">Address</div>
                                        <div class="col-6 text-end text-lg-start eh-value">405, Atul Apartment, Carter
                                            Road, 400092</div>
                                        <div class="col-12 px-3">
                                            <hr class="p-0 my-1 visit-card-eh-hr">
                                        </div>

                                        <div class="col-6 text-start eh-key">City</div>
                                        <div class="col-6 text-end text-lg-start eh-value">Mumbai</div>
                                        <div class="col-12 px-3">
                                            <hr class="p-0 my-1 visit-card-eh-hr">
                                        </div>

                                        <div class="col-6 text-start eh-key">State</div>
                                        <div class="col-6 text-end text-lg-start eh-value">Maharashtra</div>
                                        <div class="col-12 px-3">
                                            <hr class="p-0 my-1 visit-card-eh-hr">
                                        </div>

                                        <div class="col-6 text-start eh-key">GST Number</div>
                                        <div class="col-6 text-end text-lg-start eh-value">MH23435234HG</div>
                                        <div class="col-12 px-3">
                                            <hr class="p-0 my-1 visit-card-eh-hr">
                                        </div>

                                        <div class="col-6 text-start eh-key">Drug Licence Number</div>
                                        <div class="col-6 text-end text-lg-start eh-value">2435432187243</div>
                                        <div class="col-12 px-3">
                                            <hr class="p-0 my-1 visit-card-eh-hr">
                                        </div>

                                        <div class="col-6 text-start eh-key">Investigating Officer</div>
                                        <div class="col-6 text-end text-lg-start eh-value">Divyam Shah</div>
                                        <div class="col-12 px-3">
                                            <hr class="p-0 my-1 visit-card-eh-hr">
                                        </div>

                                        <div class="col-12 mt-2">
                                            <div class="mb-3">
                                                <div class="select-question-card p-2">
                                                    <div class="d-flex" id="visit2-questions" style="cursor: pointer;"
                                                        onclick="viewQuestions(this)">
                                                        <div class="col text-start">
                                                            <label for=""
                                                                class="form-label eh-label m-0">Questions</label>
                                                        </div>
                                                        <div class="col text-end">
                                                            <i class="fa fa-chevron-down"
                                                                id="visit2-questions-icon"></i>
                                                        </div>
                                                    </div>
                                                    <div id="visit2-questions-list" class="mt-4" style="display: none;">
                                                        <div class="p-2 py-0">
                                                            <label class="form-label eh-label m-0"><b>Q1)</b> What are
                                                                the complaints presented by you during the admission at
                                                                SUNFLOWER WOMENS HOSPITAL?</label>
                                                            <hr class="m-1">

                                                        </div>
                                                        <div class="p-2 py-0">
                                                            <label class="form-label eh-label m-0"><b>Q2)</b> Since when
                                                                you were suffering from the same?</label>
                                                            <hr class="m-1">

                                                        </div>
                                                        <div class="p-2 py-0">
                                                            <label class="form-label eh-label m-0"><b>Q3)</b> Where were
                                                                you consulting for the same problem before this
                                                                admission? Kindly provide a copy of the previous
                                                                consultation paper?</label>
                                                            <hr class="m-1">

                                                        </div>
                                                        <div class="p-2 py-0">
                                                            <label class="form-label eh-label m-0"><b>Q4)</b> Please
                                                                mention the reason for selecting hospital </label>
                                                            <hr class="m-1">

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div> -->
                        </div>

                        <div class="mt-5">
                            <button class="btn btn-primary eh-btn-blue-primary-no-hover w-100 py-2" id="start_investigation" style="display: none;" onclick="updateCaseStatus('Investigation')"
                                type="button"><b>Start Investigation</b></button>
                        </div>
                        <div class="mb-5"></div>
                    </div>
                    <div class="tab-pane fade" id="documents" role="tabpanel" aria-labelledby="documents-tab"
                        tabindex="0">
                        <h3 class="eh-head my-3">Case Documents</h3>
                        <label class="btn btn-primary eh-btn-blue-primary-no-hover w-100 py-2 mb-3"><b>Upload
                                Document</b>
                            <input type="file" id="addDocumentInput" hidden accept=".mp3, .wav, .ogg, .mp4, .webm, .jpg, .jpeg, .png, .gif, .webp, .pdf">
                        </label>
                        <div id="document_list_div">
                            <!-- <div class="d-flex align-items-center py-3 px-2 mb-2 document-card" onclick="openDocModal('https://pdfobject.com/pdf/sample.pdf', 'sample.pdf')">
                                <i class="fa fa-file-pdf fa-xl"></i>&nbsp;&nbsp;&nbsp; <u>sample.pdf</u>
                                <div class="ms-auto"><i class="fa fa-download fa-xl mx-2"></i></div>
                            </div> -->
                        </div>

                        <!-- Modal -->
                        <div class="modal fade" id="viewDocumentModal" tabindex="-1"
                            aria-labelledby="viewDocumentModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h1 class="modal-title fs-5 text-wrap text-break" id="viewDocumentModalLabel">View Document</h1>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <div id="document-viewer" class="viewer"></div>
                                        <!-- <div id="pdf-viewer-container" class="pdf-viewer-container">
                                            <canvas id="pdf-renderer"></canvas>
                                        </div> -->
                                        <!-- <iframe src="/media/uploads/suit_divyam(1).jpeg" width="100%" height="500px" id="viewDocumentModalIframe"
                                            style="border: none;"></iframe> -->
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="tab-pane fade" id="reports" role="tabpanel" aria-labelledby="reports-tab" tabindex="0">
                        ...
                    </div>
                </div>
                <div>

                </div>
            </div>
        </section>
    </div>

    <!-- Import BootStrap JavaScript Library -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

    <!-- Import Wow Animation JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wow/1.1.2/wow.min.js"></script>

    <script src="/static/js/process-step.js"></script>
    <script src="/static/js/loader.js"></script>
    <script src="/static/js/api_caller.js"></script>
    <script src="/static/js/script.js"></script>

    <script>
        new WOW().init();

        const caseId = new URLSearchParams(window.location.search).get('case_id');
        const visit_tab = new URLSearchParams(window.location.search).get('visit_tab');

        if (visit_tab == 'true') {
            document.getElementById('visits-tab').click();
        }

        const document_tab = new URLSearchParams(window.location.search).get('document_tab');

        if (document_tab == 'true') {
            document.getElementById('documents-tab').click();
        }

        window.onload = function () {
            getCaseDetails();
            getCaseData();
            getVistDetails();
            getInvestigatorDetails();
            getQuestions();
            toggle_loader();
        };
        processStep(1);

    </script>

    <script>
        async function getCaseData() {
            const Params = {
                case_id: caseId,
            };

            const url = "{% url 'case-api-list' %}?" + toQueryString(Params); // Construct the full URL with query params
            const [success, result] = await callApi("GET", url);
            console.log(result);
            if (success) {
                if (result.success) {
                    console.log(result.data.all_docs);
                    console.log(result.data.claim_number);
                    if (result.data.claim_number != '') {
                        document.getElementById('case_id_text').innerText = `Case #${result.data.claim_number}`;
                    } else {            
                        document.getElementById('case_id_text').innerText = `Case #${result.data.case_id}`;
                    }
                    if (result.data.case_status == 'Creation_confirmation' && document_tab == null) {
                        document.getElementById('visits-tab').click();
                    }
                    createDocumentList(result.data.all_docs);
                }
                else {
                    window.location.href=`{% url 'dashboard-list' %}`;
                }
            } else {
                window.location.href=`{% url 'dashboard-list' %}`;
            }
        }

        async function getCaseDetails() {
            const Params = {
                case_id: caseId,
            };

            const url = "{% url 'case-details-api-list' %}?" + toQueryString(Params);
            const [success, result] = await callApi("GET", url);
            console.log(result);
            if (success) {
                if (result.success) {
                    if (!result.case_details_not_added) {
                        setFormValues(result.data);
                    }
                }
                else {
                    window.location.href=`{% url 'dashboard-list' %}`;
                }
            } else {
                window.location.href=`{% url 'dashboard-list' %}`;
            }
        }

    </script>

    <script>
        // Handle Visit related functions
        function toggleCard(card) {
            let card_id = card.id;
            let card_detial_id = `${card_id}-detail`;
            let card_icon_id = `${card_id}-icon`;
            let card_details_ele = document.getElementById(card_detial_id);
            console.log(card_detial_id);
            if (card_details_ele.style.display == 'none') {
                card_details_ele.style.display = 'block';
                document.getElementById(card_icon_id).classList.remove('fa-plus');
                document.getElementById(card_icon_id).classList.add('fa-minus');
            }
            else {
                card_details_ele.style.display = 'none';
                document.getElementById(card_icon_id).classList.remove('fa-minus');
                document.getElementById(card_icon_id).classList.add('fa-plus');
            }
        }

        function handleOptionChange() {
            const select = document.getElementById('type_of_visit');
            const selectedValue = select.value;

            if (selectedValue === 'Hospital') {
                createHospitalFormInput();
                handle_hospital();
            }

            if (selectedValue === 'Lab') {
                createLabFormInput();
            }

            if (selectedValue === 'Chemist') {
                createChemistFormInput();
            }

            if (selectedValue === 'default') {
                deleteElementsWithIdPrefix('type_visit_');
            }

        }

        function createInputDiv(containerId, inputId, labelText, placeholderText, not_text=null, is_state=null) {
            const div = document.createElement('div');
            div.className = 'mb-3';
            div.id = containerId;

            const label = document.createElement('label');
            label.htmlFor = inputId;
            label.className = 'form-label eh-label';
            label.textContent = labelText;

            const input = document.createElement('input');
            if (not_text == 'date') {
                input.type = 'date';
            } else {
                input.type = 'text';
            }
            // input.type = 'text';
            input.className = 'form-control dark-input';
            input.id = inputId;
            input.name = inputId;
            input.placeholder = placeholderText;
            if (is_state) {
                input.id = 'visit_state';
            }

            div.appendChild(label);
            div.appendChild(input);

            return div;
        }

        function deleteElementsWithIdPrefix(prefix) {
            const elements = document.querySelectorAll(`[id^="${prefix}"]`);
            elements.forEach(element => element.remove());
        }

        function createHospitalFormInput() {
            deleteElementsWithIdPrefix('type_visit_');
            const parentElement = document.getElementById('add_visit_form_inputs');
            parentElement.appendChild(createInputDiv('type_visit_hospital_hospital_name', 'hospital_hospital_name', 'Hospital Name', 'Enter Hospital Name'));
            parentElement.appendChild(createInputDiv('type_visit_hospital_state', 'hospital_state', 'State', 'Enter State', null, true));
            parentElement.appendChild(createInputDiv('type_visit_hospital_city', 'hospital_city', 'City', 'Enter City'));
            parentElement.appendChild(createInputDiv('type_visit_hospital_doa', 'hospital_doa', 'Date of Admission', 'Enter Date of Admission', 'date'));
            parentElement.appendChild(createInputDiv('type_visit_hospital_dod', 'hospital_dod', 'Date of Discharge', 'Enter Date of Discharge', 'date'));
            parentElement.appendChild(createInputDiv('type_visit_hospital_claim_value', 'hospital_claim_value', 'Claim Value', 'Enter Claim Value'));
            parentElement.appendChild(createInputDiv('type_visit_hospital_diagnosis', 'hospital_diagnosis', 'Diagnosis', 'Enter Diagnosis'));
            parentElement.appendChild(createInputDiv('type_visit_hospital_registration_number', 'hospital_registration_number', 'Registration Number', 'Enter Registration Number'));
            parentElement.appendChild(createInputDiv('type_visit_hospital_no_of_beds', 'hospital_no_of_beds', 'No of Beds', 'Enter No of Beds'));
            parentElement.appendChild(createInputDiv('type_visit_hospital_icu', 'hospital_icu', 'ICU', 'Enter ICU'));
            parentElement.appendChild(createInputDiv('type_visit_hospital_ot', 'hospital_ot', 'OT', 'Enter OT'));
            parentElement.appendChild(createInputDiv('type_visit_hospital_nursing_staff', 'hospital_nursing_staff', 'Nursing staff', 'Enter Nursing staff'));
            parentElement.appendChild(createInputDiv('type_visit_hospital_rmo', 'hospital_rmo', 'RMO', 'Enter RMO'));
            parentElement.appendChild(createInputDiv('type_visit_hospital_td_registration_number', 'hospital_td_registration_number', 'TD registration number', 'Enter TD registration number'));
            parentElement.appendChild(createInputDiv('type_visit_hospital_degree', 'hospital_degree', 'Degree', 'Enter Degree'));
            parentElement.appendChild(createInputDiv('type_visit_hospital_owner_of_the_hospital', 'hospital_owner_of_the_hospital', 'Owner of the hospital', 'Enter Owner of the hospital'));
            parentElement.appendChild(createInputDiv('type_visit_hospital_doctor_registration_number', 'hospital_doctor_registration_number', 'Registration Number', 'Enter Registration Number'));
            parentElement.appendChild(createInputDiv('type_visit_hospital_doctor_contact_number', 'hospital_doctor_contact_number', 'Contact Number', 'Enter Contact Number'));
            parentElement.appendChild(createInputDiv('type_visit_hospital_doctor_email', 'hospital_doctor_email', 'Email Id', 'Enter Email Id'));
            parentElement.appendChild(createInputDiv('type_visit_hospital_tat', 'hospital_tat', 'TAT', 'Enter TAT'));
            handle_visit_state();
        }

        function createLabFormInput() {
            deleteElementsWithIdPrefix('type_visit_');
            const parentElement = document.getElementById('add_visit_form_inputs');
            parentElement.appendChild(createInputDiv('type_visit_lab_name', 'lab_name', 'Name', 'Enter Name'));
            parentElement.appendChild(createInputDiv('type_visit_lab_city', 'lab_city', 'City', 'Enter City'));
            parentElement.appendChild(createInputDiv('type_visit_lab_state', 'lab_state', 'State', 'Enter State', null, true));
            parentElement.appendChild(createInputDiv('type_visit_lab_address', 'lab_address', 'Address', 'Enter Address'));
            parentElement.appendChild(createInputDiv('type_visit_lab_pathologist_name', 'lab_pathologist_name', 'Pathologist Name', 'Enter Pathologist Name'));
            parentElement.appendChild(createInputDiv('type_visit_lab_registration_number', 'lab_registration_number', 'Registration Number', 'Enter Registration Number'));
            parentElement.appendChild(createInputDiv('type_visit_lab_tat', 'lab_tat', 'TAT', 'Enter TAT'));
            handle_visit_state();
        }

        function createChemistFormInput() {
            deleteElementsWithIdPrefix('type_visit_');
            const parentElement = document.getElementById('add_visit_form_inputs');
            parentElement.appendChild(createInputDiv('type_visit_chemist_name_of_chemist', 'chemist_name_of_chemist', 'Name of Chemist', 'Enter Name of Chemist'));
            parentElement.appendChild(createInputDiv('type_visit_chemist_address', 'chemist_address', 'Address', 'Enter Address'));
            parentElement.appendChild(createInputDiv('type_visit_chemist_state', 'chemist_state', 'State', 'Enter State', null, true));
            parentElement.appendChild(createInputDiv('type_visit_chemist_city', 'chemist_city', 'City', 'Enter City'));
            parentElement.appendChild(createInputDiv('type_visit_chemist_gst_number', 'chemist_gst_number', 'GST Number', 'Enter GST Number'));
            parentElement.appendChild(createInputDiv('type_visit_chemist_drug_license_number', 'chemist_drug_license_number', 'Drug Licence Number', 'Enter Drug Licence Number'));
            parentElement.appendChild(createInputDiv('type_visit_chemist_tat', 'chemist_tat', 'TAT', 'Enter TAT'));
            handle_visit_state();
        }

        function toggleAddQuestions() {
            let question_list = document.getElementById('questions-list');

            if (question_list.style.display == 'none') {
                question_list.style.display = 'block';
                document.getElementById('add-question-icon').classList.remove('fa-chevron-down');
                document.getElementById('add-question-icon').classList.add('fa-chevron-up');
            }
            else {
                question_list.style.display = 'none';
                document.getElementById('add-question-icon').classList.remove('fa-chevron-up');
                document.getElementById('add-question-icon').classList.add('fa-chevron-down');
            }
        }

        function generateQuestions(questions) {
            const container = document.getElementById('questions-list'); // Create a container for the checkboxes
            questions.forEach((question, index) => {
                const questionNumber = index + 1; // Calculate the question number

                // Create the outer div with class "form-check"
                const div = document.createElement('div');
                div.className = 'form-check';

                const input = document.createElement('input');
                input.type = 'checkbox';
                input.className = 'form-check-input eh-checkbox';
                input.id = `visit_question${questionNumber}`;
                input.name = `question${questionNumber}`;
                input.value = question.id;

                const label = document.createElement('label');
                label.className = 'form-check-label';
                label.setAttribute('for', `visit_question${questionNumber}`);
                label.textContent = question.question;

                div.appendChild(input);
                div.appendChild(label);

                container.appendChild(div);

                const hr = document.createElement('hr');
                hr.className = 'my-2';
                container.appendChild(hr);
            });
        }

        function viewQuestions(questions) {
            let question_list = document.getElementById(`${questions.id}-list`);

            if (question_list.style.display == 'none') {
                question_list.style.display = 'block';
                document.getElementById(`${questions.id}-icon`).classList.remove('fa-chevron-down');
                document.getElementById(`${questions.id}-icon`).classList.add('fa-chevron-up');
            }
            else {
                question_list.style.display = 'none';
                document.getElementById(`${questions.id}-icon`).classList.remove('fa-chevron-up');
                document.getElementById(`${questions.id}-icon`).classList.add('fa-chevron-down');
            }
        }

        function createVisitCard(type_of_visit, cardId, visitNumber, details, questions, visit_id) {
            // Create the outer card container
            const card = document.createElement('div');
            card.className = 'p-3 mt-3 visit-card';

            // Create the header section
            const header = document.createElement('div');
            header.className = 'd-flex';
            header.id = `card-${cardId}`;
            header.setAttribute('onclick', 'toggleCard(this)');
            header.style.cursor = 'pointer';

            // Header - Left side (Visit Number)
            const headerLeft = document.createElement('div');
            headerLeft.className = 'col-10 text-start';
            const title = document.createElement('h5');
            title.className = 'm-0';
            // title.textContent = `Visit Number ${visitNumber}`;
            title.textContent = `${type_of_visit} Visit`;
            headerLeft.appendChild(title);

            // Header - Right side (Toggle Icon)
            const headerRight = document.createElement('div');
            headerRight.className = 'col text-end';
            const icon = document.createElement('i');
            icon.className = 'fa fa-plus';
            icon.id = `card-${cardId}-icon`;
            headerRight.appendChild(icon);

            // Append header left and right to the header
            header.appendChild(headerLeft);
            header.appendChild(headerRight);

            // Create the details section
            const detailsDiv = document.createElement('div');
            // detailsDiv.className = 'wow animate__animated animate__fadeInDown';
            // detailsDiv.setAttribute('data-wow-duration', '0.2s');
            detailsDiv.style.display = 'none';
            detailsDiv.id = `card-${cardId}-detail`;

            // Add a horizontal line
            const hr = document.createElement('hr');
            detailsDiv.appendChild(hr);

            // Create the details content
            const detailsRow = document.createElement('div');
            detailsRow.className = 'row';

            // Edit and Delete icons
            const actionCol = document.createElement('div');
            actionCol.className = 'col-12 text-end mb-3';
            const editIcon = document.createElement('i');
            editIcon.className = 'fa fa-pen fa-lg eh-text-blue-primary';
            editIcon.setAttribute('onclick', `editVisitDetail('${visit_id}');`);
            const deleteIcon = document.createElement('i');
            deleteIcon.className = 'fa fa-trash fa-lg text-danger';
            actionCol.appendChild(editIcon);
            actionCol.innerHTML += '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
            actionCol.appendChild(deleteIcon);
            detailsRow.appendChild(actionCol);

            // Add each key-value pair to the details
            for (const [key, value] of Object.entries(details)) {
                // Key column
                const keyCol = document.createElement('div');
                keyCol.className = 'col-6 text-start eh-key';
                keyCol.textContent = key;

                // Value column
                const valueCol = document.createElement('div');
                valueCol.className = 'col-6 text-end text-lg-start text-break eh-value';
                valueCol.textContent = value;

                // Append key and value columns
                detailsRow.appendChild(keyCol);
                detailsRow.appendChild(valueCol);

                // Add a horizontal line after each detail
                const detailHrDiv = document.createElement('div');
                detailHrDiv.className = 'col-12 px-3';
                const detailHr = document.createElement('hr');
                detailHr.className = 'p-0 my-1 visit-card-eh-hr';
                detailHrDiv.appendChild(detailHr);
                detailsRow.appendChild(detailHrDiv);
            }

            // Append the details row to the details div
            detailsDiv.appendChild(detailsRow);

            // Questions Section
            const questionsContainer = document.createElement('div');
            questionsContainer.className = 'col-12 mt-2';
            const questionCard = document.createElement('div');
            questionCard.className = 'select-question-card p-2';

            const questionHeader = document.createElement('div');
            questionHeader.className = 'd-flex';
            questionHeader.id = `visit${visitNumber}-questions`;
            questionHeader.style.cursor = 'pointer';
            questionHeader.setAttribute('onclick', 'viewQuestions(this)');

            const questionHeaderLeft = document.createElement('div');
            questionHeaderLeft.className = 'col text-start';
            const questionLabel = document.createElement('label');
            questionLabel.className = 'form-label eh-label m-0';
            questionLabel.textContent = 'Questions';
            questionHeaderLeft.appendChild(questionLabel);

            const questionHeaderRight = document.createElement('div');
            questionHeaderRight.className = 'col text-end';
            const questionIcon = document.createElement('i');
            questionIcon.className = 'fa fa-chevron-down';
            questionIcon.id = `visit${visitNumber}-questions-icon`;
            questionHeaderRight.appendChild(questionIcon);

            questionHeader.appendChild(questionHeaderLeft);
            questionHeader.appendChild(questionHeaderRight);

            const questionList = document.createElement('div');
            questionList.id = `visit${visitNumber}-questions-list`;
            questionList.className = 'mt-4';
            questionList.style.display = 'none';

            // Add individual questions
            questions.forEach((question, index) => {
                const questionItem = document.createElement('div');
                questionItem.className = 'p-2 py-0';

                const questionLabel = document.createElement('label');
                questionLabel.className = 'form-label eh-label m-0';
                questionLabel.innerHTML = `<b>Q${index + 1})</b> ${question}`;

                const hr = document.createElement('hr');
                hr.className = 'm-1';

                questionItem.appendChild(questionLabel);
                questionItem.appendChild(hr);

                questionList.appendChild(questionItem);
            });

            questionCard.appendChild(questionHeader);
            questionCard.appendChild(questionList);
            questionsContainer.appendChild(questionCard);

            detailsRow.appendChild(questionsContainer);

            // Append the header and details section to the card
            card.appendChild(header);
            card.appendChild(detailsDiv);

            return card;
        }

        // All Visit related api caller
        async function getVistDetails() {
            const Params = {
                case_id: caseId,
            };

            const url = "{% url 'visit-api-list' %}?" + toQueryString(Params);
            const [success, result] = await callApi("GET", url);
            console.log(result);
            if (success) {
                if (result.success) {
                    if (!result.no_visit_for_case){
                        result.data.forEach((visit, index) => {
                            document.getElementById('start_investigation').style.display = '';
                            document.getElementById('no-visit-created').style.display = 'none';
                            console.log(visit);
                            const visit_card = createVisitCard(visit.type_of_visit, index, index, visit.final_card_data, visit.questions, visit.visit_id);
                            document.getElementById('visit-cards').appendChild(visit_card);
                        });
                    }
                }
                else {
                    // window.location.href=`{% url 'dashboard-list' %}`;
                }
            } else {
                // window.location.href=`{% url 'dashboard-list' %}`;
            }
        }
        
        function handle_visit_state() {
            document.getElementById('visit_state').addEventListener('change', function() {
                const state = this.value;
                getInvestigatorDetails(state);
            });
        }

        async function getInvestigatorDetails(state=null) {
            deleteElementsWithIdPrefix('investigator_officer_option_');
            const Params = {
                user_role: "investigator",
            };

            if (state != null) {
                Params['state'] = state;
            }

            const url = "{% url 'list_users_by_role-list' %}?" + toQueryString(Params); // Construct the full URL with query params
            const [success, result] = await callApi("GET", url);
            if (success) {
                console.log("GET User Success:", result);
                const selectElement = document.getElementById('investigator_select');

                // Loop through the list of dictionaries
                result.data.users.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item.user_id;  // Set the value from the dictionary
                    option.textContent = item.name;  // Set the text from the dictionary
                    option.id = `investigator_officer_option_${item.user_id}`;
                    selectElement.appendChild(option);  // Append the option to the select element
                });

            } else {
                console.error("GET User Failed:", result);
            }
        }

        async function getQuestions() {
            const url = "{% url 'question-api-list' %}?";
            const [success, result] = await callApi("GET", url);
            console.log(result);
            if (success) {
                if (result.success) {
                    console.log(result.data);
                    generateQuestions(result.data)
                }
                else {
                    // window.location.href=`{% url 'dashboard-list' %}`;
                }
            } else {
                // window.location.href=`{% url 'dashboard-list' %}`;
            }
        }

        function getSelectedVisitQuestions() {
            const checkboxes = document.querySelectorAll("input[type='checkbox'][id^='visit_question']");
            const selectedValues = [];
            checkboxes.forEach((checkbox) => {
                if (checkbox.checked) {
                    selectedValues.push(checkbox.value);
                }
            });            
            return selectedValues;
        }

        async function createNewVisit() {
            if (document.getElementById('edit_visit_id').value == ''){
                let new_visit_detail = {
                    'case_id': caseId
                }
                var form_new_visit = new FormData(document.getElementById('add_visit_form'));
                form_new_visit.forEach((value, key) => {
                    if (!Object.prototype.hasOwnProperty.call(new_visit_detail, key)) {
                        new_visit_detail[key] = value;
                        return;
                    }
                    if (!Array.isArray(new_visit_detail[key])) {
                        new_visit_detail[key] = [new_visit_detail[key]];
                    }
                    new_visit_detail[key].push(value);
                });
    
                new_visit_detail['questions'] = getSelectedVisitQuestions();
                console.log(new_visit_detail);
    
                const bodyData = new_visit_detail;
    
                const url = "{% url 'visit-api-list' %}";
                const [success, result] = await callApi("POST", url, bodyData, "{{csrf_token}}");
                if (success) {
                    window.location.href=`{% url 'case_overview-list' %}?case_id=${caseId}&visit_tab=true`;
                } else {
                    alert('Unable to create new visit`');
                }
            }

            else {
                updateVisit();
            }
        }

        async function editVisitDetail(visit_id) {
            const Params = {
                visit_id: visit_id,
            };

            const url = "{% url 'visit-details-api-list' %}?" + toQueryString(Params);
            const [success, result] = await callApi("GET", url);
            console.log(result);
            if (success) {
                if (result.success) {
                    uncheckQuestions();
                    handleEditVisitModal(result.data.type_of_visit);
                    setFormValues(result.data);
                
                }
                else {
                    window.location.href=`{% url 'dashboard-list' %}`;
                }
            } else {
                window.location.href=`{% url 'dashboard-list' %}`;
            }
        }

        function handleEditVisitModal(type_of_visit){
            document.getElementById('addVisitBtn').click();
            document.getElementById('type_of_visit').value = type_of_visit;
            handleOptionChange();
            document.getElementById('type_of_visit').disabled = true;
        }

        function defaultVisitModal(){
            document.getElementById('type_of_visit').value = 'default';
            handleOptionChange();
            document.getElementById('edit_visit_id').value = '';
            document.getElementById('investigator_select').value = '';
            document.getElementById('type_of_visit').disabled = false;
            document.getElementById('addVisitBtnModal').click();
            uncheckQuestions();

        }

        function uncheckQuestions() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"][name^="question"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
        }

        async function updateVisit() {
            visit_id = document.getElementById('edit_visit_id').value
            let update_visit_detail = {
                'visit_id': visit_id
            }

            var form_new_visit = new FormData(document.getElementById('add_visit_form'));
            form_new_visit.forEach((value, key) => {
                if (!Object.prototype.hasOwnProperty.call(update_visit_detail, key)) {
                    update_visit_detail[key] = value;
                    return;
                }
                if (!Array.isArray(update_visit_detail[key])) {
                    update_visit_detail[key] = [update_visit_detail[key]];
                }
                update_visit_detail[key].push(value);
            });

            update_visit_detail['type_of_visit'] = document.getElementById('type_of_visit').value;

            update_visit_detail['questions'] = getSelectedVisitQuestions();
            console.log(update_visit_detail);

            const bodyData = update_visit_detail;

            const url = "{% url 'update-visit-api-list' %}";
            const [success, result] = await callApi("POST", url, bodyData, "{{csrf_token}}");
            console.log(result);
            if (success) {
                window.location.href=`{% url 'case_overview-list' %}?case_id=${caseId}&visit_tab=true`;
            } else {
                alert('Unable to save the visit details');
            }
        }

    </script>

    <script>
        document.getElementById("case_details_form").addEventListener("submit", async (event) => {
            toggle_loader();
            const form = event.target;
            event.preventDefault();

            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            showModal(
                'Confirm Action',
                '<p>Are you sure you want to submit case details?</p>',
                async () => {
                    let claim_number = document.getElementById('claim_number').value;
                    let insurance_company = document.getElementById('insurance_company').value;
                    let type_of_case = document.getElementById('type_of_case').value;
                    let doa = document.getElementById('doa').value;
                    let dod = document.getElementById('dod').value;
                    let hospital_name = document.getElementById('hospital_name').value;
                    let city = document.getElementById('city').value;
                    let state = document.getElementById('state').value;
                    let claim_value = document.getElementById('claim_value').value;
                    let diagnosis = document.getElementById('diagnosis').value;

                    const bodyData = {
                        'case_id': caseId,
                        'claim_number': claim_number,
                        'insurance_company': insurance_company,
                        'type_of_case': type_of_case,
                        'doa': doa,
                        'dod': dod,
                        'hospital_name': hospital_name,
                        'city': city,
                        'state': state,
                        'claim_value': claim_value,
                        'diagnosis': diagnosis,
                    };

                    const url = "{% url 'case-details-api-list' %}";
                    const [success, result] = await callApi("POST", url, bodyData, "{{csrf_token}}");
                    console.log(result)
                    if (success) {
                        if (result.success) {
                            setFormValues(result.data);
                            window.location.href=`{% url 'case_overview-list' %}?case_id=${caseId}&visit_tab=true`;
                        }
                    } else {
                        alert('Unable to save the case details');
                    }

                
                }
            );

            
            toggle_loader();
        });

    </script>

    <script>
        // Handle document section

        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';

        function openDocModal(doc_path, doc_name) {
            displayDocument(doc_path);
            document.getElementById('viewDocumentModalLabel').innerText = doc_name;
            const myModal = new bootstrap.Modal(document.getElementById('viewDocumentModal'));
            myModal.show();
        }

        function createDocumentList(documentList) {
            const container = document.getElementById('document_list_div');

            documentList.forEach((docItem) => {
                const documentDiv = document.createElement('div');
                documentDiv.className = 'd-flex align-items-center py-3 px-2 mb-2 document-card';
                documentDiv.setAttribute('onclick', `openDocModal('${docItem.path}','${docItem.name}')`);

                const icon = document.createElement('i');
                icon.className = 'fa fa-file-pdf fa-xl';

                const documentName = document.createElement('u');
                documentName.className = 'text-break';
                documentName.textContent = docItem.name;

                const nameContainer = document.createElement('div');
                nameContainer.appendChild(icon);
                nameContainer.appendChild(document.createTextNode('\u00A0\u00A0\u00A0')); // Adding spaces
                nameContainer.appendChild(documentName);

                const downloadDiv = document.createElement('div');
                downloadDiv.className = 'ms-auto';

                const downloadIcon = document.createElement('a');
                downloadIcon.href = docItem.path;
                downloadIcon.download = docItem.name;
                downloadIcon.className = 'fa fa-download fa-xl mx-2 text-black';
                downloadIcon.addEventListener('click', (event) => {
                    event.stopPropagation();
                });

                downloadDiv.appendChild(downloadIcon);

                documentDiv.appendChild(nameContainer);
                documentDiv.appendChild(downloadDiv);

                container.appendChild(documentDiv);
            });
        }

        function loadPDF(docPath) {
            const pdfRenderer = document.getElementById('pdf-renderer');
            const canvasContext = pdfRenderer.getContext('2d');

            // Load the PDF document
            pdfjsLib.getDocument(docPath).promise.then((pdf) => {
                // Load the first page of the PDF
                pdf.getPage(1).then((page) => {
                    const viewport = page.getViewport({ scale: 0.5 });

                    // Adjust canvas dimensions
                    pdfRenderer.width = viewport.width;
                    pdfRenderer.height = viewport.height;

                    // Render the PDF page into the canvas context
                    page.render({
                        canvasContext: canvasContext,
                        viewport: viewport,
                    });
                });
            }).catch((error) => {
                console.error('Error rendering PDF:', error);
            });
        }

        document.getElementById('addDocumentInput').addEventListener('change',async function (event) {
            const allowedExtensions = ['mp3', 'wav', 'ogg', 'mp4', 'webm', 'jpg', 'jpeg', 'png', 'gif', 'webp', 'pdf'];
            const file = event.target.files[0];
            console.log(file)

            if (file) {
                const fileExtension = file.name.split('.').pop().toLowerCase();

                if (!allowedExtensions.includes(fileExtension)) {
                    alert(`Unsupported file type: ${file.name}`);
                    // Clear the input if invalid file is uploaded
                    event.target.value = '';
                    return;
                }

                const formData = new FormData();
                formData.append('file', file);

                const bodyData = formData;
                formData.append('case_id', caseId);
            
                const url = "{% url 'add-case-document-api-list' %}";
                const [success, result] = await callApi("POST", url, bodyData, "{{csrf_token}}", true);
                console.log(result);
                if (success) {
                    let case_id = result.data.case_id;
                    window.location.href=`{% url 'case_overview-list' %}?case_id=${case_id}&document_tab=true`;
                } else {
                    
                }

            }
        });

    </script>

    <script>
        async function updateCaseStatus(status) {
            showModal(
                'Confirm Action',
                '<p>Are you sure you want to continue?</p>',
                async () => {
                    const Params = {
                        case_id: caseId,
                        case_status: status
                    };
        
                    const url = "{% url 'set-status-api-list' %}?" + toQueryString(Params);
                    const [success, result] = await callApi("GET", url);
                    console.log(result);
                    if (success) {
                        if (result.success) {                
                                console.log(result.data);
                                location.reload();
                        }
                        else {
                            window.location.href=`{% url 'dashboard-list' %}`;
                        }
                    } else {
                        window.location.href=`{% url 'dashboard-list' %}`;
                    }
                    
                }
            );

        }

    </script>

</body>

</html>