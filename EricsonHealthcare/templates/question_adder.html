<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Ericson Healthcare - Dashboard</title>

    <!-- Import BootStrap CSS Library -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <!-- Import Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Lexend:wght@100..900&family=Plus+Jakarta+Sans:ital,wght@0,200..800;1,200..800&display=swap">

    <!-- Import FontAwsome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- Import Wow Animation CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/loader.css">

</head>

<body>
    <div id="spinner" class="spinner-container p-2">
        <div class="spinner"></div>
    </div>

    <div id="main-content" class="blur">
        <div class="px-3 px-md-5 py-3 bg-white eh-bg-blue-primary fixed-top text-white">
            <div class="d-flex justify-content-between align-items-center">
                <div class="dropdown">
                    <button type="button" class="btn p-0" data-bs-toggle="dropdown">
                        <i class="fa fa-circle-user fa-xl text-white" style="color: #000;"></i>
                    </button>                
                    <div class="dropdown-menu dropdown-menu-start" aria-labelledby="transactionID">
                        <div class="px-3">
                            <b><u id="account-card-name"></u></b>
                            <small id="account-card-email"></small>
                            <small id="account-card-number"></small>
                        </div>
                    </div>
                </div>
                <div class="mx-auto p-0" style="font-size: 18px;"><b>ERICSON HEALTHCARE</b></div>
                <!-- <i class="fa fa-bell fa-xl me-2"></i> -->
                <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas"
                    data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar" aria-label="Toggle navigation">
                    <i class="fa fa-bars fa-xl"></i>
                </button>
            </div>
        </div>

{% include 'nav.html' %}
        <div class="container mt-5 pt-3">
            <div class="text-start mt-3 mb-2">
                <h3 class="eh-text-blue-primary"><b>Hello <span id="account_name"></span></b></h3>
                <small class="m-0 eh-small">Question Adder</small>
            </div>

            <div class="my-3">
                <button type="button" id="add_question_btn"
                    class="btn eh-btn-blue-primary w-100 d-flex justify-content-between align-items-center py-2"
                    data-bs-toggle="modal" data-bs-target="#addQuestionModal">
                    <b class="mx-auto">Add Question</b>
                    <i class="fa fa-plus fa-xl"></i>
                </button>

                <!-- Modal -->
                <div class="modal fade" id="addQuestionModal" tabindex="-1" aria-labelledby="addQuestionModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                        <h1 class="modal-title fs-5" id="addQuestionModalLabel">Add New Question</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <h5 class="eh-head">Enter Question</h5>
                            <div class="mb-3">
                                <input type="text" class="form-control dark-input" id="newQuestionInput" name="newQuestionInput" placeholder="Enter Question">
                            </div>
                        </div>
                        <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary eh-btn-blue-primary-no-hover" onclick="uploadNewQuestion()">Add Question</button>
                        </div>
                    </div>
                    </div>
                </div>
            </div>

            <div class="my-4">
                <small class="eh-small" id="total_questions">All Questions</small>
                <div class="table-responsive">
                    <table class="table table-bordered text-center">
                        <thead class="table-light align-top">
                            <tr>
                                <th scope="col">Sr. No.</th>
                                <th scope="col">Question</th>                                
                                
                            </tr>
                        </thead>
                        <tbody id="question_table">
                            <tr class="align-middle">
                                <td>1</td>
                                <td>Divyam Shah</td>
                            </tr>    
                            <tr>
                                <td>2</td>
                                <td>Divyam Shah</td>
                            </tr>        
                        </tbody>
                    </table>
                </div>

            </div>

        </div>

    </div>

    <!-- Import BootStrap JavaScript Library -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

    <!-- Import Wow Animation JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wow/1.1.2/wow.min.js"></script>

    <script src="/static/js/loader.js"></script>
    <script src="/static/js/api_caller.js"></script>

    <script>
        window.onload = function () {
            GetDashboardDetails();
            getQuestions();
            toggle_loader();
        };
    </script>

    <script>
        let UserData = {};

        async function GetDashboardDetails() {
            
            const url = "{% url 'dashboard-api-list' %}";
            const [success, result] = await callApi("POST", url, null, "{{csrf_token}}");
            console.log(result);

            if (success) {
                if (result.success){
                    UserData = result.data;

                    document.getElementById('account_name').innerText = UserData.name;
                    document.getElementById('account-card-name').innerText = UserData.name;
                    document.getElementById('account-card-email').innerText = UserData.email;
                    document.getElementById('account-card-number').innerText = UserData.contact_number;

                    const validRoles = ['admin', 'hod', 'coordinator'];
                    if (validRoles.includes(UserData.role)) {
                        
                        // document.getElementById('report-nav-tab').style.display = '';

                    }
                    
                }

                else {
                    window.location.href=`{% url 'login-list' %}`;
                }

            } else {
                window.location.href=`{% url 'login-list' %}`;

            }
        }

        async function getQuestions() {
            let total_questions = 0;
            document.getElementById('question_table').innerHTML = '';
            
            const url = "{% url 'question-api-list' %}?";
            const [success, result] = await callApi("GET", url);
            console.log(result);
            if (success) {
                if (result.success) {
                    console.log(result.data);
                    console.log('aegthratrhwer')
                    result.data.forEach(async (question, index) => {
                        total_questions++;
                        let row = `<tr>
                            <td>${index + 1}</td>
                            <td><u>${question.question}</u></td>
                        </tr>`;

                        document.getElementById('question_table').innerHTML += row;
                    });
                    document.getElementById('total_questions').innerText = `All Questions (${total_questions})`;
                }
                else {
                    // window.location.href=`{% url 'dashboard-list' %}`;
                }
            } else {
                // window.location.href=`{% url 'dashboard-list' %}`;
            }
        }

        async function uploadNewQuestion() {
            let new_question = document.getElementById('newQuestionInput').value;
            
            if (new_question === "") {
                alert("Please enter a question");
                return;
            }

            const bodyData = {
                question: new_question
            };

            const url = "{% url 'question-api-list' %}";
            const [success, result] = await callApi("POST", url, bodyData, "{{csrf_token}}");
            if (success) {
                if (result.success) {
                    alert("Question Added Successfully");
                    getQuestions();
                    document.getElementById('newQuestionInput').value = '';
                    document.getElementById('add_question_btn').click();
                } else {
                    console.error("Failed:", result);
                }
            } else {
                console.error("Failed:", result);
            }

        }

    </script>

</body>

</html>
